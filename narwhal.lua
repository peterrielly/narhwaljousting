-- title:  Narhwal Jousting
-- author: Pete Rielly
-- desc:   Narhwals... jousting
-- script: lua

t=0
x=96
y=24
vx=0
vy=0
g=0.25
f=.95
maxFall=0.5
maxUp=-3
maxX=1.5
solids={49,50,51}

player={
flip=0
}
function canMove(x,y)
	local	mx=(x//16)+2
	local	my=(y-7)//16
	local tile = mget(mx,my)
	for i=1,#solids do
		if tile == solids[i] then 
			return false 
		end
	end
	
	return true
end

function remap(tile,x,y)
	if tile==48 then
		return tile,t//30%2,0
	else
		return tile
	end
end

function TIC()
	mx=x//16
	my=(y+16-7)//16

	if btn(2) then
		if math.abs(vx)<maxX then
		 vx=vx-0.1
			player.flip=0
	 end
	end
	if btn(3) then 
		if math.abs(vx)<maxX then
		 vx=vx+0.1
			player.flip=1
	 end
	end

	if btnp(4) or btnp(5) then
		vy=vy-3
		
		if vy < maxUp then
			vy=maxUp
		end
	end
			
	if vy < maxFall then
		vy=vy+g
	end
	
	--check down collison
	if vy>0 then
		if canMove(x//1+2,y//1+16) and canMove(x//1+14,y//1+16) then
			y=y+vy
		else 
			vy=0
		end
	elseif vy<0 then --check up
		if y+vy>5 and canMove(x//1+2,y//1) and canMove(x//1+14,y//1) then y=y+vy end
	end

	--check right collison
	if vx>0 then
		if canMove(x//1+16,y//1+15) and canMove(x//1+16,y//1) then
			x=x+vx
		else 
			vx=0
		end
	elseif vx<0 then --check left
		if canMove(x//1,y//1+15) and canMove(x//1,y//1) then
			x=x+vx
		else 
			vx=0
		end
	end
	
	if x<-14 then x=239 end
	if x>239 then x=-14 end
		
	vx=vx*f
	cls(0)
	map(2,0,15,8,0,7,-1,2,remap)
--	spr(1+t%60//30*2,x,y,0,1,0,0,2,2)
	spr(53+t%30//15,x,y,-1,2,player.flip)
	spr(55+t%30//15,20,20,-1,2,1)
	spr(64+t%30//15,20,103,-1,2,1)
	
	print(x,0,0,11)
	t=t+1
end

-- <TILES>
-- 001:000000000000000000002222232322220232222200222222022ac222022cc222
-- 002:0000000000000000000000002200000022220000222220002222200022222200
-- 003:000000000000000000002222232322220232222200222222022ac222022cc222
-- 004:0000000000000000000000002200000022220000222220002222200022222200
-- 017:2222222232222223032222320322222200032222000002330000000000000000
-- 018:2333220032223200222232222223222322222230333222000000000000000000
-- 019:2222222232222222032222220322222300032222000002330000000000000000
-- 020:2222220022222200222332003222322033323232333322030000000000000000
-- 048:bbbbbbbbbbbbbbbbbbaabbaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 049:3333333333333333030303033030303000000000030003000000000000030003
-- 050:9333333930000003300000039333333999999999999999999999999999999999
-- 051:0333333030000003303300033030000330000003300000033000000303333330
-- 052:0000400000044000044444404044440444444444444040440404044000444400
-- 053:0000000044400000004440000404440004444440044444440044440400044000
-- 054:0000000044400000004440000404440404444444044444400044440000044000
-- 055:0000000055500000005550000505550005555550055555550055550500055000
-- 056:0000000055500000005550000505550505555555055555500055550000055000
-- 057:0000500000055000055555505055550555555555555050550505055000555500
-- 058:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 059:9999999999999999999999999999999999999999999999999999999999999999
-- 060:a9a9a9a99a9a9a9aa9a9a9a99a9a9a9aa9a9a9a99a9a9a9aa9a9a9a99a9a9a9a
-- 064:0020002020200022220000222200002200222200020220200222222002000020
-- 065:0200020022000202220000222200002200222200020220200222222020000002
-- 066:00000000000bb00000b00b000b0000b00b0000b000b00b00000bb00000000000
-- 067:0000000000000000000bb00000b00b0000b00b00000bb0000000000000000000
-- 068:000b00000b0000b00000000000000000b000000b0000000000b00000000000b0
-- 128:00cccccc0c000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 129:cccccccc00000000000000000000000000000000000000000000000000000000
-- 130:cccccc00000000c00000000c0000000c0000000c0000000c0000000c0000000c
-- 144:c0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 145:00cccc000c0000c0c000000cc000000cc000000cc000000c0c0000c000cccc00
-- 146:0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 149:cc000000ccc00000cccccccccccccccccccccccccccccccc0ccccccc00cccccc
-- 150:0000000000000000cccccccccccccccccccccccccccccccccccccccccccccccc
-- 151:000000cc00000cccccccccccccccccccccccccccccccccccccccccc0cccccc00
-- 153:00000000000000000cccccc00c0000c00cccccc00c0000c00cccccc00c0000c0
-- 154:000000c0000c0c0c00c0c0c00c0c0c0000c0c0c0000c0c0000c0c00000000000
-- 160:c0000000c0000000c0000000c0000000c0000000c00000000c00000000cccccc
-- 161:00000000000000000000000000000000000000000000000000000000cccccccc
-- 162:0000000c0000000c0000000c0000000c0000000c0000000c000000c0cccccc00
-- 192:0000004000000404000040400000040400004040000004040000404000000404
-- 193:4040404004040404404040400404040440404040040404044040404004040404
-- 194:4040000004040000404040000404000040404000040400004040400004040000
-- 208:0000404000000404000040400000040400004040000004040000404000000404
-- 210:4040400004040000404040000404000040404000040400004040400004040000
-- 225:0022000220022020020222000002200000222000002200000022000000220000
-- 226:0077007777007700000000000000000000000000000000000000000000000000
-- 227:0000000000000000000100000011100000111000011111000001000000001000
-- </TILES>

-- <SPRITES>
-- 096:00cccccc0c000000c00c0cc0c0c00000c0c00000c0c00000c0000000c0000000
-- 097:cccccc00000000c00000000c0000000c0000000c0000000c0000000c0000000c
-- 098:0000000000cccccc0c000000c00c0cc0c0c00000c0c00000c0c00000c0000000
-- 099:00000000cccccc00000000c00000000c0000000c0000000c0000000c0000000c
-- 112:c0000000c0000000c0000000cc000000cccccccccccccccc0ccccccc00cccccc
-- 113:0000000c0000000c0000000c000000ccccccccccccccccccccccccc0cccccc00
-- 114:c0000000c0000000c0000000c0000000cc000000cccccccccccccccc0ccccccc
-- 115:0000000c0000000c0000000c0000000c000000ccccccccccccccccccccccccc0
-- 201:0000000000010100000010001111111100111100000110000000000000000000
-- 202:0000000000010100000010000011110001111110010110100000000000000000
-- </SPRITES>

-- <MAP>
-- 000:000003030303030303030303030303030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:0000a3a3a3a3a3a3a333a3a3a3a3a3a3a300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:0000a3a3a3a3a3a3a3a3a3a3a3a3a3a3a300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:0000c3c3c3c3c3c3c3c3c3c3c3c3c3c3c30000000000000000000000000000000000000c1c2c00000c1c2c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:0000b3b3b33333b3b3b3b3b3b3b3b3b3b30000000000000000000000000000000000000d1c2d000c2c1c2d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:0000b3b3b3b3b3b3b3b3b3b33333b3b3b3000000000000000000000000000000000000001e003e00001e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:0000b3b3b3b3b3b3b3b3b3b3b3b3b3b3b300000000003333333300000000000000002e2e2e2e2e2e2e2e2e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:1313131313131313131313131313131313131300000000000000000000000000000000000000000000002e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:330000000000003333330000000033000000081818181818280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:330000000000000000000000000033000000090818181828290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:3300000000000000000000000000330000000909000000292900000000a9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:33000000000000000033333333003300000009596969997929000000a9a9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:33003333330000000000000000003300000009000000000029000000a900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:330000000000000000000000000033000000596999696969790000a9a900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:3300000000000000000000000000330000000000a9a900000000a9a90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:330000000000000000000000000033000000000000a9a9a9a9a9a9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

